FROM python:3.7-slim-buster


RUN apt-get update

RUN apt-get -y install libpq-dev python3-dev gcc libsnappy-dev
RUN apt-get -y install g++
COPY python-airflow-libs.txt /tmp/
RUN pip install  -r /tmp/python-airflow-libs.txt
RUN pip install pandas==0.23.4
RUN apt-get purge --auto-remove -yqq $buildDeps && apt-get autoremove -yqq --purge \
    && apt-get clean && rm -rf var/lib/apt/lists/* /tmp/* /var/tmp/* /usr/share/man \
        /usr/share/doc /usr/share/doc-base

COPY --from=puckel/docker-airflow:latest / /

COPY airflow-entrypoint.sh /entrypoint.sh

RUN chown airflow: /entrypoint.sh

RUN mkdir /data/
RUN chown -R airflow: /data/
RUN chmod  755 -R /data/
EXPOSE 8793

RUN apt-get -y install bash

USER airflow
WORKDIR /code/
